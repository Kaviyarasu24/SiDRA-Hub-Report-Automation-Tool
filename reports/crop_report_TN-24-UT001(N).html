<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Crop Report
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
 </head>
 <body class="bg-white">
    <!-- PDF Download Button -->
  <div class="fixed top-4 right-4 z-50">
   <button id="downloadPdf" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg flex items-center gap-2 transition-colors">
    <i class="fas fa-download"></i>
    Download PDF
   </button>
  </div>
  
  <div id="reportContent" class="max-w-7xl mx-auto p-6 bg-[#dbe8f2] rounded-3xl relative" style="min-height: 800px; height: auto;">
   <img alt="SiRDA_Logo" class="absolute top-6 left-6 w-[300px] h-[60px] object-contain" height="70" src="../assest/sidralogo.png" width="300"/>
   <img alt="KSRCT_Logo" class="absolute top-6 right-6 w-[60px] h-[60px] object-contain" height="60" src="../assest/ksrctlogo.png " width="60"/>
   <h1 class="text-[72px] font-sans font-normal text-[#1f2937] text-center mt-20 mb-8">
    Crop Report
   </h1>
   <div class="max-w-[600px] mx-auto mt-8 mb-6 rounded-3xl overflow-hidden">
    <img alt="Farmland image" class="w-full h-auto object-cover rounded-3xl" height="300" src="../assest/farmland.png" width="600"/>
   </div>
   <div class="flex justify-center items-center mt-4 mb-6 text-black font-extrabold text-lg">
    <i class="fas fa-map-marker-alt mr-2">
    </i>
    TN-24-UT001(N) Information
   </div>
   <div class="max-w-4xl mx-auto mt-6 grid grid-cols-2 gap-x-20 gap-y-3 text-[18px] font-sans">
    <div class="space-y-3">
     <div class="text-gray-600 font-semibold">
      <span>Field Name: </span>
      <span class="font-extrabold">TN-24-UT001(N)</span>
     </div>
     <div class="text-gray-600 font-semibold">
      <span>Crop Name: </span>
      <span class="font-extrabold">-</span>
     </div>
     <div class="text-gray-600 font-semibold">
      <span>Sowing Date: </span>
      <span class="font-extrabold">-</span>
     </div>
    </div>
    <div class="space-y-3">
     <div class="text-gray-600 font-semibold">
      <span>Report Date: </span>
      <span class="font-extrabold">2025-08-12</span>
     </div>
     <div class="text-gray-600 font-semibold">
      <span>Area Coverage: </span>
      <span class="font-extrabold">0.65 ha</span>
     </div>
     <div class="text-gray-600 font-semibold">
      <span>Growth Stage: </span>
      <span class="font-extrabold">Not specified</span>
     </div>
    </div>
   </div>
  </div>
   
  </div>
  <!-- Extra padding to ensure all content is captured in PDF -->
  <div class="pb-10"></div>

  <script>
    document.getElementById('downloadPdf').addEventListener('click', function() {
      console.log('PDF download button clicked');
      
      // Hide the download button during PDF generation
      this.style.display = 'none';
      
      const element = document.getElementById('reportContent');
      console.log('Report element found:', element);
      
      if (!element) {
        alert('Report content not found!');
        this.style.display = 'flex';
        return;
      }
      
      // Store original styles to restore later
      const originalHeight = element.style.height;
      const originalMinHeight = element.style.minHeight;
      const originalOverflow = element.style.overflow;
      
      // Set styles for PDF generation
      element.style.height = 'auto';
      element.style.minHeight = 'auto';
      element.style.overflow = 'visible';
      
      // Wait for any dynamic content to load
      setTimeout(() => {
        console.log('Starting PDF generation...');
        
        // Optimized options for better PDF quality and reliability
        const opt = {
          margin: 5,
          filename: 'crop_report_TN-24-UT001(N).pdf',
          image: { 
            type: 'jpeg', 
            quality: 0.98
          },
          html2canvas: { 
            scale: 2,
            useCORS: true,
            allowTaint: true,
            letterRendering: true,
            backgroundColor: '#dbe8f2'
          },
          jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait'
          }
        };
        
        // Generate PDF directly from the element
        html2pdf()
          .from(element)
          .set(opt)
          .save()
          .then(() => {
            console.log('PDF generation successful');
            
            // Show the download button again
            document.getElementById('downloadPdf').style.display = 'flex';
            
            // Reset styles to original values
            element.style.height = originalHeight;
            element.style.minHeight = originalMinHeight || '800px';
            element.style.overflow = originalOverflow;
          })
          .catch((error) => {
            console.error('PDF generation failed:', error);
            
            // Show the download button again
            document.getElementById('downloadPdf').style.display = 'flex';
            
            // Reset styles to original values
            element.style.height = originalHeight;
            element.style.minHeight = originalMinHeight || '800px';
            element.style.overflow = originalOverflow;
            
            alert('PDF generation failed: ' + error.message);
          });
      }, 500);
    });
  </script>
 </body>
</html>

